<map proto="1.5.0">
<name>Prospect Park</name>
<game>Teamfight Touchdown</game>
<version>1.0.0</version>
<created>2025-09-19</created>
<constants>
    <constant id="team-size">12</constant>
    <constant id="team-one-name">Blue</constant>
    <constant id="team-two-name">Red</constant>
    <constant id="team-one-color">blue</constant>
    <constant id="team-two-color">dark red</constant>
    <constant id="team-one-spawn">125.5,20,0.5</constant>
    <constant id="team-one-yaw">90</constant>
    <constant id="team-two-spawn">-124.5,20,0.5</constant>
    <constant id="team-two-yaw">-90</constant>
    <constant id="flag-post">0,13,0</constant>
    <constant id="fire-material">fire</constant>
    <constant id="enable-night-vision">true</constant>
    <constant id="main-kit">base-kit</constant>
    <constant id="flag-carrier-effects">flag-carrier-effects</constant>
    <constant id="flag-drop-kit">custom-flag-drop-kit</constant>
    <constant id="flag-color">white</constant>
    <constant id="void-plane">0</constant>
    <constant id="flag-respawn">8s</constant>
    <constant id="flag-prerespawn">7.8s</constant>
    <constant id="time-limit">10m</constant>
    <constant id="indicator-outer-material"  delete="true"/> <!-- Delete to disable physical indicators -->
    <constant id="indicator-inner-material" delete="true"/>
    <!--custom constants for classes abilties-->
    <constant id="superjump-ability-cooldown">15</constant>
    <constant id="tackle-ability-cooldown">80</constant>
    <if variant="comp">
        <constant id="team-size">9</constant>
        <constant id="instaheal-default">0</constant>
        <constant id="respawn-timer" delete="true"/>
    </if>
</constants>
<include id="touchdown"/>
<authors>
    <author uuid="1aad55f7-2dea-4f22-85ca-ad9de3a78609" contribution="Map decorator and xml dev"/> <!-- Technodono -->
    <author uuid="fbd1c001-bbeb-4aac-8f18-2b1962fe6722" contribution="Map builder"/> <!-- TheM1ghtyBear -->
</authors>
<contributors>
    <contributor uuid="fe3608b7-d105-4029-8800-34b3147065b6" contribution="Custom trees"/> <!-- rockymine -->
</contributors>
<kits>
    <kit id="base-kit">
        <clear items="true" armor="false" effects="false"/>
        <item slot="1" amount="6" projectile="arrow" name="`rCrossbow" lore="`r`7Right-click to fire!" material="firework charge"/>
        <item slot="7" material="compass"/>
        <item slot="8" material="golden apple"/>
        <kit id="apply-custom-heathbars"/>
        <game-mode>adventure</game-mode>
    </kit>
    <kit id="custom-flag-carrier-effects">
        <unless constant="enable-night-vision" constant-value="true">
            <effect>night vision</effect>
        </unless>
        <effect>slowness</effect>
        <effect duration="3s">fire resistance</effect>
    </kit>
    <kit id="custom-flag-drop-kit">
        <action filter="alive">
            <action>
                <replace-item>
                    <find prevent-sharing="true" consumable="use-snowball" name="`4`lFootball" material="snowball"/>
                    <replace material="air"/>
                </replace-item>
            </action>
            <kit id="${armor-kit}"/>
            <action id="apply-heal"/>
        </action>
    </kit>
    <kit id="apply-custom-heathbars" force="true">
        <kit id="light-class-health"/>
        <kit id="ultra-light-class-health"/>
    </kit>
    <kit id="apply-custom-flag-heathbars">
        <kit id="medium-class-flag-health"/>
        <kit id="light-class-flag-health"/>
    </kit>
    <kit id="light-class-health" filter="any(has-ranger,has-jumper)">
        <max-health>16</max-health>
    </kit>
    <kit id="ultra-light-class-health" filter="has-sprinter">
        <max-health>12</max-health>
    </kit>
    <kit id="medium-class-flag-health" filter="any(has-attacker,has-defender,has-blocker)">
        <max-health>14</max-health>
    </kit>
    <kit id="light-class-flag-health" filter="any(has-ranger,has-jumper,has-sprinter)">
        <max-health>12</max-health>
    </kit>
</kits>
<classes family="Classes">
    <class name="Attacker" default="true" description="`a`lMovement| ██`8░ `n`6`lCombat| ██`8░ `n`d`lHealth| ██`8░ `n`b`l Ability: `7None " icon="gold sword">
        <kit parents="base-kit">
            <item slot="0" unbreakable="true" material="stone sword"/>
            <attribute operation="base" amount="0.75">generic.movementSpeed</attribute>
        </kit>
    </class>
    <class name="Defender" description="`a`lMovement| █`8░░ `n`6`lCombat| ██`7▒ `n`d`lHealth| ███ `n`b`l Ability: `7Extra Protection" icon="iron chestplate">
        <kit parents="base-kit">
            <item slot="0" unbreakable="true" material="stone sword" enchantment="sharpness:1"/>
            <attribute operation="base" amount="0.65">generic.movementSpeed</attribute>
            <knockback-reduction>0.25</knockback-reduction>
            <shield health="4" delay="8s"/>
        </kit>
    </class>
    <class name="Ranger" description="`a`lMovement| ██`8░ `n`6`lCombat| ███ `n`d`lHealth| █`7▒`8░ `n`b`l Ability: `7Bow Kit" icon="bow">
        <kit parents="base-kit">
            <item slot="0" unbreakable="true" material="stone sword"/>
            <item slot="2" unbreakable="true" material="bow"/>
            <item slot="9" amount="12" material="arrow"/>
            <attribute operation="base" amount="0.75">generic.movementSpeed</attribute>
        </kit>
    </class>
    <class name="Sprinter" description="`a`lMovement| ███ `n`6`lCombat| █`8░░ `n`d`lHealth| █`8░░ `n`b`l Ability: `7Flag Runner" icon="feather">
        <kit parents="base-kit">
            <item slot="0" unbreakable="true" material="wood sword"/>
            <attribute operation="base" amount="0.9">generic.movementSpeed</attribute>
        </kit>
    </class>
    <class name="Jumper" description="`a`lMovement| ██`7▒ `n`6`lCombat| █`8░░ `n`d`lHealth| █`7▒`8░ `n`b`l Ability: `7Superjump" icon="flint and steel">
        <kit parents="base-kit">
            <item slot="0" unbreakable="true" material="wood sword"/>
            <attribute operation="base" amount="0.75">generic.movementSpeed</attribute>
            <double-jump recharge-time="${superjump-ability-cooldown}" power="4.5"/>
        </kit>
    </class>
    <class name="Blocker" description="`a`lMovement| █`7▒`8░ `n`6`lCombat| ██`8░ `n`d`lHealth| ██`8░ `n`b`l Ability: `7Tackle" icon="anvil">
        <kit parents="base-kit">
            <item slot="0" unbreakable="true" material="stone sword"/>
            <item slot="2" material="gold hoe" enchantment="knockback:2" prevent-sharing="true" name="`rAbility: `e`lTackle" lore="`7Instantly strips the flag carrier."/>
            <action id="fill-xp-bar"/>
            <knockback-reduction>0.25</knockback-reduction>
            <attribute operation="base" amount="0.70">generic.movementSpeed</attribute>
        </kit>
    </class>
</classes>
<projectiles> 
    <projectile id="arrow" name="crossbow bolt" velocity="4" damage="7" throwable="true" cooldown="2.5s"/>
</projectiles>
<spawns>
    <default>
        <region yaw="180">
            <point>0.5,6,105.5</point>
        </region>
    </default>
</spawns>
<variables>
    
    <player-location id="xp_bar_prog" component="exp progress"/>
    <variable id="tackle_ability_cd" default="0" scope="player"/>
</variables>
<filters>
    <above id="team-one-6s" x="34"/>
    <above id="team-one-4.5s" x="12"/>
    <below id="team-two-6s" x="-33"/>
    <below id="team-two-4.5s" x="-11"/>
    <class id="has-attacker">Attacker</class>
    <class id="has-defender">Defender</class>
    <class id="has-ranger">Ranger</class>
    <class id="has-sprinter">Sprinter</class>
    <class id="has-jumper">Jumper</class>
    <class id="has-blocker">Blocker</class>
    <after filter="not(has-flag)" duration="0.01" id="not-has-flag-0.01"/>
    <after filter="has-flag" duration="0.01" id="has-flag-0.01"/>
    <pulse id="tackle-progress" duration="0.05" period="0.1" filter="tackle_ability_cd=1.."/>
    <all id="can-force-strip-flag">
        <victim>
            <variable var="player_state">${carry}</variable>
        </victim>
        <all id="attacker-is-using-ability">
            <cause>melee</cause>
            <attacker>
                <holding id="holding-gold-hoe" ignore-metadata="true" ignore-name="true" ignore-enchantments="true">
                    <item material="gold hoe"/>
                </holding>
            </attacker>
        </all>
    </all>
    <carrying id="has-gold-hoe">
        <item material="gold hoe" enchantment="knockback:2" prevent-sharing="true" name="`rAbility: `e`lTackle" lore="`7Instantly strips the flag carrier."/>
    </carrying>
    <carrying id="has-stone-hoe" ignore-metadata="true" ignore-name="true" ignore-enchantments="true">
        <item material="stone hoe" prevent-sharing="true" name="`7Ability: `8`lTackle" lore="`7Instantly strips the flag carrier."/>
    </carrying>
</filters>
<actions>
    <trigger filter="not-has-flag-0.01" action="set-custom-healthbar" scope="player"/>
    <action id="set-custom-healthbar" scope="player">
        <kit id="apply-custom-heathbars"/>
    </action>
    <trigger filter="has-flag-0.01" action="set-custom-flag-healthbar" scope="player"/>
    <action id="set-custom-flag-healthbar" scope="player">
        <kit id="apply-custom-flag-heathbars"/>
    </action>
    <action id="use-tackle-ability" scope="player" filter="attacker-is-using-ability">
        <action filter="can-force-strip-flag">
            <action id="flag-steal-event"/>
        </action>
        <replace-item>
            <find material="gold hoe" enchantment="knockback:2" prevent-sharing="true" name="`rAbility: `e`lTackle" lore="`7Instantly strips the flag carrier."/>
            <replace material="stone hoe" prevent-sharing="true" name="`7Ability: `8`lTackle" lore="`7Instantly strips the flag carrier."/>
        </replace-item>
        <set var="tackle_ability_cd" value="${tackle-ability-cooldown}"/>
        <set var="xp_bar_prog" value="0"/>
    </action>
    <trigger filter="tackle-progress" scope="player">
        <action>
            <set var="tackle_ability_cd" value="tackle_ability_cd-1"/>
            <set var="xp_bar_prog" value="min(0.99, 1 - (tackle_ability_cd/${tackle-ability-cooldown}))" />
            <action filter="tackle_ability_cd=0">
                <replace-item>
                    <find material="stone hoe" prevent-sharing="true" name="`7Ability: `8`lTackle" lore="`7Instantly strips the flag carrier."/>
                    <replace material="gold hoe" enchantment="knockback:2" prevent-sharing="true" name="`rAbility: `e`lTackle" lore="`7Instantly strips the flag carrier."/>
                </replace-item>
            </action>
        </action>
    </trigger>
    <action id="fill-xp-bar"  scope="player">
        <set var="xp_bar_prog" value="1"/>
    </action>
    <action id="receive-tackle-ability" scope="player" filter="can-force-strip-flag">
        <set var="player_state" value="${initial}"/>
        <set var="flag_carrier" value="0"/>
    </action>
    <trigger filter="all(not(has-gold-hoe),not(has-stone-hoe))" action="give-new-tackle-ability" scope="player"/>
    <action id="give-new-tackle-ability" scope="player" filter="all(has-blocker,alive)">
        <action filter="tackle_ability_cd=1..">
            <kit>
                <item material="stone hoe" prevent-sharing="true" name="`7Ability: `8`lTackle" lore="`7Instantly strips the flag carrier."/>
            </kit>
        </action>
        <action filter="tackle_ability_cd=0">
            <kit>
                <item material="gold hoe" enchantment="knockback:2" prevent-sharing="true" name="`rAbility: `e`lTackle" lore="`7Instantly strips the flag carrier."/>
            </kit>
        </action>
    </action>
    <action id="custom-attacker-actions" scope="player">
        <action id="reset-after-throw"/>
        <action id="use-tackle-ability"/>
    </action>
    <action id="custom-victim-actions" scope="player">
        <action id="damage-receive-event"/>
        <action id="receive-tackle-ability"/>
    </action>
</actions>
<regions>
    <cuboid id="playing-field" min="-142,0,73" max="143,50,-72"/>
    <!-- scoring zones -->
    <union id="team-one-portal">
        <cuboid min="115,6,25" max="142,10,72"/>
        <cuboid min="-115,6,-24" max="142,10,-71"/>
    </union>
    <union id="team-two-portal">
        <cuboid min="-114,6,-24" max="-141,10,-71"/>
        <cuboid min="-114,6,25" max="-141,10,72"/>
    </union>
    <cuboid id="red-pad" min="-117,21,-2" max="-115,22,3"/>
    <mirror id="blue-pad" origin="0.5,13,0.5" normal="1,0,0" region="red-pad"/>
    <apply block-physics="never"/>
    <apply velocity="2,0.8,0.0" region="red-pad"/>
    <apply velocity="-2,0.8,0.0" region="blue-pad"/>
</regions>
<compass show-distance="true">
    <player filter="has-flag" show-player="true" name="Flag Carrier"/>
</compass>
<damage attacker-action="custom-attacker-actions" victim-action="custom-victim-actions"/>
<kill-rewards>
    <kill-reward>
        <item amount="3" projectile="arrow" name="`rCrossbow" lore="`r`7Right-click to fire!" material="firework charge"/>
    </kill-reward>
    <kill-reward filter="has-ranger">
        <item amount="6" material="arrow"/>
    </kill-reward>
</kill-rewards>
<itemkeep>
    <item>firework charge</item>
    <item>compass</item>
    <item>gold hoe</item>
    <item>stone hoe</item>
    <item>arrow</item>
    <item>bow</item>
</itemkeep>
<toolrepair>
    <tool>compass</tool>
</toolrepair>
<respawn delay="${respawn-timer}" auto="false"/>
</map>
